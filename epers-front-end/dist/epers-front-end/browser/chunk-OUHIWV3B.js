import{b as Se}from"./chunk-BUQCJ4EJ.js";import{a as te}from"./chunk-GP76AYW4.js";import{h as Z,j as $,k as ee}from"./chunk-7HPXOHU7.js";import{$a as ue,Bb as ge,F as u,Ga as C,Ha as w,I as d,J as _,K as q,Ka as L,L as f,La as x,Na as ie,Nb as he,O as r,Oa as oe,Q as F,Qa as E,Ra as T,S as s,Sa as ne,T as n,U as l,Va as P,Wa as re,X as A,Xa as se,Z as M,Za as ae,_ as c,_a as me,ab as le,bb as ce,cb as pe,da as S,ea as a,f as B,g as W,h as G,hb as de,ia as j,ib as fe,j as H,ja as N,ka as D,la as g,m as U,ma as Q,o as J,p as R,qa as K,r as h,sa as I,v,va as X,w as b,ya as Y}from"./chunk-5G5VBFYZ.js";var y=(()=>{class t{constructor(e,i,o,p,Ce,xe){this.httpClient=e,this.userStateService=i,this.ddStateService=o,this.firmeService=p,this.selectionBoxStateService=Ce,this.router=xe,this.baseUrl=C.baseUrl,this.isAuthenticatedSubject=new B(!1)}login(e){return this.httpClient.post(this.baseUrl+"/Authentication/login",e,{withCredentials:!0}).pipe(U(i=>{i&&(this.handleAuthentication(i),this.scheduleTokenRefresh(i.expiresIn))}),H(i=>G(()=>i))).pipe(U(()=>{this.ddStateService.upsertDropdowns(),this.selectionBoxStateService.upsertSelections(),this.firmeService.upsertDDFirme()}))}refreshToken(){return this.httpClient.post(this.baseUrl+"/Authentication/refresh-token",{}).pipe(U(e=>{this.scheduleTokenRefresh(e)}))}isAuthenticated$(){return this.checkAuthStatus(),this.isAuthenticatedSubject.asObservable()}isAuthenticated(){return this.checkAuthStatus(),this.isAuthenticatedSubject.value}logout(){this.httpClient.post(this.baseUrl+"/Authentication/logout/",null).subscribe(()=>{this.userStateService.loggedInUserSubject.next(null),this.isAuthenticatedSubject.next(!1),localStorage.removeItem("user"),this.router.navigate([""])})}logoutUserNoNavigation(){this.httpClient.post(this.baseUrl+"/Authentication/logout/",null).subscribe(()=>{this.userStateService.loggedInUserSubject.next(null),localStorage.removeItem("user")})}getUserRoleId(){if(this.isAuthenticated())return JSON.parse(localStorage.getItem("user")).idRol}checkAuthStatus(){JSON.parse(localStorage.getItem("user"))?.id&&this.isAuthenticatedSubject.getValue()===!1&&this.isAuthenticatedSubject.next(!0)}handleAuthentication(e){let i={id:e.id,idRol:e.idRol,idPost:e.idPost,idLocatie:e.idLocatie,idCompartiment:e.idCompartiment,idSuperior:e.idSuperior,idFirma:e.idFirma,matricola:e.matricola,rol:e.rol,numePrenume:e.numePrenume,username:e.username,matricolaSuperior:e.matricolaSuperior,numeSuperior:e.numeSuperior,expiresIn:e.expiresIn};this.userStateService.loggedInUserSubject.next(i),localStorage.setItem("user",JSON.stringify(i)),this.isAuthenticatedSubject.next(!0)}scheduleTokenRefresh(e){this.refreshTimeout&&clearTimeout(this.refreshTimeout);let i=e*1e3;this.refreshTimeout=setTimeout(()=>{this.refreshToken().subscribe()},i)}static{this.\u0275fac=function(i){return new(i||t)(h(Y),h(w),h($),h(ee),h(te),h(L))}}static{this.\u0275prov=J({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ae=()=>["/forgotPassword"];function Me(t,m){t&1&&(s(0,"span",16),a(1,"C\xE2mpul este obligatoriu!"),n())}function we(t,m){t&1&&(s(0,"span",16),a(1,"C\xE2mpul este obligatoriu!"),n())}function Le(t,m){if(t&1){let e=A();s(0,"div",6)(1,"section")(2,"form",7,0),M("ngSubmit",function(){v(e);let o=c();return b(o.onLogin())}),l(4,"hr"),s(5,"div",8)(6,"label",9),a(7,"Nume Utilizator"),n(),s(8,"input",10,1),D("ngModelChange",function(o){v(e);let p=c();return N(p.user.username,o)||(p.user.username=o),b(o)}),n(),f(10,Me,2,0,"span",11),n(),s(11,"div",8)(12,"label",12),a(13,"Parola"),n(),s(14,"input",13,2),D("ngModelChange",function(o){v(e);let p=c();return N(p.user.password,o)||(p.user.password=o),b(o)}),n(),f(16,we,2,0,"span",11),n(),s(17,"div",8)(18,"button",14),a(19," Intra\u021Bi \xEEn cont "),n()(),s(20,"div",8)(21,"a",15),a(22," Am uitat parola "),n()()()()()}if(t&2){let e=S(3),i=S(9),o=S(15),p=c();u(8),F("invalid",i.touched&&i.invalid),j("ngModel",p.user.username),u(2),r("ngIf",!i.valid&&i.touched),u(4),F("invalid",o.touched&&o.invalid),j("ngModel",p.user.password),u(2),r("ngIf",!o.valid&&o.touched),u(2),r("disabled",e.invalid),u(3),r("routerLink",g(10,Ae))}}function Ee(t,m){t&1&&(s(0,"div",17),l(1,"mat-spinner"),n())}var be=(()=>{class t{constructor(e,i,o){this.authService=e,this.toastr=i,this.router=o,this.user={},this.isLoginInProgress=!1}onLogin(){this.isLoginInProgress=!0,this.authService.login(this.user).subscribe({next:e=>{e&&e?.id?this.router.navigate(["./"]):this.toastr.error("Utilizatorul sau parola nu sunt corecte!"),this.isLoginInProgress=!1},error:e=>{this.isLoginInProgress=!1,e.error?.message?this.toastr.error(e?.error?.message):this.toastr.error(e?.message)}})}onCancel(){this.user.username="nume_utilizator",this.user.password="parola"}static{this.\u0275fac=function(i){return new(i||t)(d(y),d(Z),d(L))}}static{this.\u0275cmp=_({type:t,selectors:[["login"]],standalone:!1,decls:5,vars:2,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"row"],["class","col-6","style","font-size: small",4,"ngIf"],["class","col-6",4,"ngIf"],[1,"col-6",2,"font-size","small"],["id","login",3,"ngSubmit"],[1,"form-group","p-2"],["for","login-username"],["type","email","id","login-username","name","username","required","",1,"form-control",3,"ngModelChange","ngModel"],["class","help-block help-block-danger",4,"ngIf"],["for","login-password"],["type","password","for","password","id","login-password","name","password","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit","mat-raised-button","","color","primary",1,"form-control",3,"disabled"],["type","button","mat-raised-button","","color","basic ","href","#",1,"form-control",3,"routerLink"],[1,"help-block","help-block-danger"],[1,"col-6"]],template:function(i,o){i&1&&(s(0,"h3"),a(1,"Autentificare"),n(),s(2,"div",3),f(3,Le,23,11,"div",4)(4,Ee,2,0,"div",5),n()),i&2&&(u(3),r("ngIf",!o.isLoginInProgress),u(),r("ngIf",o.isLoginInProgress))},dependencies:[I,pe,ae,me,ue,de,ce,le,ne,T,ge,x],encapsulation:2})}}return t})();var ke=()=>["../auth/login"];function Fe(t,m){if(t&1){let e=A();s(0,"button",2),M("click",function(){v(e);let o=c();return b(o.logout())}),l(1,"mat-icon",3),a(2," Deconectare"),n()}}function je(t,m){t&1&&(s(0,"a",4),a(1,"Autentificare"),n()),t&2&&r("routerLink",g(1,ke))}var _e=(()=>{class t{constructor(e){this.authService=e}logout(){this.authService.logout()}static{this.\u0275fac=function(i){return new(i||t)(d(y))}}static{this.\u0275cmp=_({type:t,selectors:[["logout"]],inputs:{isUserAuth:"isUserAuth"},standalone:!1,decls:2,vars:2,consts:[["mat-menu-item","","class","btn btn-sm btn-danger",3,"click",4,"ngIf"],["mat-menu-item","","class","btn btn-sm btn-primary",3,"routerLink",4,"ngIf"],["mat-menu-item","",1,"btn","btn-sm","btn-danger",3,"click"],["fontIcon","exit_to_app"],["mat-menu-item","",1,"btn","btn-sm","btn-primary",3,"routerLink"]],template:function(i,o){i&1&&f(0,Fe,3,0,"button",0)(1,je,2,2,"a",1),i&2&&(r("ngIf",o.isUserAuth),u(),r("ngIf",!o.isUserAuth))},dependencies:[I,E,P,x],encapsulation:2})}}return t})();var De=t=>["/utilizatori/changePassword/",t],Ve=()=>["../utilizatori/add"],ze=()=>["../utilizatori/userDbSetup"],Oe=()=>["../utilizatori/export-evaluari"];function Be(t,m){if(t&1&&(s(0,"button",6),l(1,"mat-icon",7),a(2," Utilizator"),n()),t&2){c();let e=S(3);r("ngClass","white-button")("matMenuTriggerFor",e)}}function We(t,m){if(t&1&&(s(0,"button",8),l(1,"mat-icon",7),a(2," Utilizator"),n()),t&2){c();let e=S(3);r("matMenuTriggerFor",e)}}function Ge(t,m){if(t&1&&(s(0,"button",9),l(1,"mat-icon",10),a(2," Gestionare parol\u0103"),n()),t&2){let e=c();r("routerLink",Q(1,De,e.userId))}}function He(t,m){t&1&&(s(0,"button",9),l(1,"mat-icon",11),a(2," \xCEnregistrare Utilizator"),n()),t&2&&r("routerLink",g(1,Ve))}function Je(t,m){t&1&&(s(0,"button",9),a(1," Setup Utilizatori new app "),n()),t&2&&r("routerLink",g(1,ze))}function Re(t,m){t&1&&(s(0,"button",9),a(1," Export Evaluari (PDF + Excel) "),n()),t&2&&r("routerLink",g(1,Oe))}var Ie=class O{constructor(m,e){this.authService=m,this.userStateService=e,this.userIsAdminOrHR=!1}ngOnInit(){this.companyName=C.companyName,this.displayUserSetup=C.displayUserSetup,this.displayGenerarePdfExcelEvaluari=C.displayGenerarePdfExcelEvaluari;let m=JSON.parse(localStorage.getItem("user"))?.idRol;this.userIsAdminOrHR=m===1||m===4,this.userQuerySub=this.userStateService.loggedInUser$.subscribe(e=>{e?this.userId=e.id:(this.isUserAuth=this.authService.isAuthenticated(),this.isUserAuth&&(this.userStateService.upsertUserDataWithLocalStorage(),this.userId=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user"))?.id:null))}),this.userAuthenticatedSub=this.authService.isAuthenticated$().subscribe(e=>{this.isUserAuth=e})}onLogout(){this.isUserAuth=!1}static{this.\u0275fac=function(e){return new(e||O)(d(y),d(w))}}static{this.\u0275cmp=_({type:O,selectors:[["user-profile"]],standalone:!1,decls:11,vars:7,consts:[["menu","matMenu"],["mat-button","",3,"ngClass","matMenuTriggerFor",4,"ngIf"],["mat-button","",3,"matMenuTriggerFor",4,"ngIf"],[1,"dropdown-item",2,"background-color","#ECE3E2"],["mat-menu-item","",3,"routerLink",4,"ngIf"],[3,"isUserAuth"],["mat-button","",3,"ngClass","matMenuTriggerFor"],["fontIcon","perm_identity"],["mat-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["fontIcon","lock"],["fontIcon","account_circle"]],template:function(e,i){e&1&&(f(0,Be,3,2,"button",1)(1,We,3,1,"button",2),s(2,"mat-menu",null,0)(4,"h6",3),a(5,"Administrare cont"),n(),f(6,Ge,3,3,"button",4)(7,He,3,2,"button",4)(8,Je,2,2,"button",4)(9,Re,2,2,"button",4),l(10,"logout",5),n()),e&2&&(r("ngIf",i.companyName!=="demo"),u(),r("ngIf",i.companyName==="demo"),u(5),r("ngIf",i.isUserAuth),u(),r("ngIf",i.userIsAdminOrHR),u(),r("ngIf",i.displayUserSetup),u(),r("ngIf",i.displayGenerarePdfExcelEvaluari&&i.userIsAdminOrHR),u(),r("isUserAuth",i.isUserAuth))},dependencies:[K,I,E,T,re,P,se,x,_e],encapsulation:2})}};Ie=W([oe({checkProperties:!0})],Ie);var St=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=q({type:t})}static{this.\u0275inj=R({imports:[X,fe,he,ie.forChild([{path:"login",component:be},{path:"forgotPassword",component:Se}])]})}}return t})();export{y as a,Ie as b,St as c};
